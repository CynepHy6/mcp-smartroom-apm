# MCP APM Server

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ APM –ª–æ–≥–∞–º Skyeng Platform —á–µ—Ä–µ–∑ Elasticsearch API.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç –ü–æ–∏—Å–∫ –ª–æ–≥–æ–≤ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º
- üìã –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ø–æ–ª–µ–π –∏ —Å–æ–±—ã—Ç–∏–π –∏–Ω–¥–µ–∫—Å–∞ (–∏–∑ index.yaml)
- üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–µ–¥–æ–≤, —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- üìë –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- üöÄ –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Linux, macOS –∏ Windows

## –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

**–î–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º:**
```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ –ª—é–±—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
git clone <repository-url> mcp-smartroom-apm
cd mcp-smartroom-apm

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
python3 setup.py    # Linux/macOS
python setup.py     # Windows
```

–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
- –°–æ–∑–¥–∞—Å—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –°–æ–∑–¥–∞—Å—Ç —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞ –¥–ª—è –≤–∞—à–µ–π –û–°

## –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd /path/to/your/projects
git clone <repository-url> mcp-smartroom-apm
cd mcp-smartroom-apm

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
python3 -m venv venv                    # Linux/macOS
python -m venv venv                     # Windows

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv/bin/activate                # Linux/macOS
venv\Scripts\activate                   # Windows

pip install -r requirements.txt

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
nano .env                               # Linux/macOS
notepad .env                            # Windows
```

–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `.env`:
```bash
APM_BASE_URL=https://apm.skyeng.link
APM_USERNAME=your_username
APM_PASSWORD=your_password
APM_TIMEOUT=30
```

## –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

**Linux/macOS:**
```bash
python3 mcp-server
# –∏–ª–∏ –ø–æ—Å–ª–µ chmod +x mcp-server
./mcp-server
```

**Windows:**
```batch
python mcp-server
# –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π bat-—Ñ–∞–π–ª
start_server.bat
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
```bash
python3 mcp-server --help    # –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Linux, macOS –∏ Windows
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –û–°
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç bash –∏–ª–∏ PowerShell

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤, –ø–æ–ª–µ–π –∏ —Å–æ–±—ã—Ç–∏–π

**GET /v1/indexes**

–û—Ç–≤–µ—Ç:
```json
[
  {
    "name": "logs_videocall",
    "fields": {
      "appSessionId": "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–µ—Å—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ö—ç—à –∫–æ–º–Ω–∞—Ç—ã",
      "event": "–¢–∏–ø —Å–æ–±—ã—Ç–∏—è: tech-summary-minute",
      "timestamp": "–í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è",
      "userId": "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    },
    "events": [
      {"name": "tech-summary-minute", "description": "–æ—Ç—á–µ—Ç –ø–æ –ú–û–° –∑–∞ –º–∏–Ω—É—Ç—É"},
      {"name": "webrtcIssue", "description": "–ø—Ä–æ–±–ª–µ–º—ã —Å WebRTC, –∞—É–¥–∏–æ, –≤–∏–¥–µ–æ, —Å–∫—Ä–∏–Ω—à–µ—Ä–∏–Ω–≥"}
    ]
  }
]
```

### 2. –ü–æ–∏—Å–∫ –ª–æ–≥–æ–≤ –ø–æ –∏–Ω–¥–µ–∫—Å—É

**POST /v1/query/{index}**

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (–ø—Ä–∏–º–µ—Ä):
```json
{
  "filters": {
    "appSessionId": "abc123def456",
    "event": "tech-summary-minute",
    "timestamp": {"gte": "2024-01-15T10:00:00", "lte": "2024-01-15T11:00:00"}
  },
  "size": 10,
  "from_": 0,
  "sort": [{"@timestamp": "desc"}]
}
```

- `filters` ‚Äî —Å–ª–æ–≤–∞—Ä—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ (term –∏–ª–∏ range)
- `size` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100, –º–∞–∫—Å–∏–º—É–º 100)
- `from_` ‚Äî —Å–º–µ—â–µ–Ω–∏–µ (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
- `sort` ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–û—Ç–≤–µ—Ç: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç Elasticsearch

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ curl

```bash
curl -X GET http://localhost:8000/v1/indexes

curl -X POST http://localhost:8000/v1/query/logs_videocall \
  -H 'Content-Type: application/json' \
  -d '{"filters": {"event": "tech-summary-minute"}, "size": 5}'
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
mcp-smartroom-apm/
‚îú‚îÄ‚îÄ mcp-apm-server.py         # –û—Å–Ω–æ–≤–Ω–æ–π MCP —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ mcp-server               # –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ setup.py                 # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îú‚îÄ‚îÄ start_server.bat         # Windows bat-—Ñ–∞–π–ª (—Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ Windows)
‚îú‚îÄ‚îÄ index.yaml               # –û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤, –ø–æ–ª–µ–π –∏ —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ .env                     # –ö—Ä–µ–¥—ã (—Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)
‚îú‚îÄ‚îÄ .env.example             # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md                # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–∏—à—É—Ç—Å—è –≤ `mcp-apm-server.log`
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è: –≤—Ä–µ–º—è, —É—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ù–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è: –ø–∞—Ä–æ–ª–∏ –∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

- **401** ‚Äî –æ—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫—Ä–µ–¥—ã –≤ .env
- **404** ‚Äî –∏–Ω–¥–µ–∫—Å –Ω–µ –Ω–∞–π–¥–µ–Ω: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –≤ index.yaml
- **503** ‚Äî –æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ APM_BASE_URL –∏ —Å–µ—Ç—å

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- –î–æ—Å—Ç—É–ø –∫ APM Skyeng Platform

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- fastapi
- uvicorn
- python-dotenv
- pyyaml
- elasticsearch
- httpx

## –õ–∏—Ü–µ–Ω–∑–∏—è

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Skyeng Platform 